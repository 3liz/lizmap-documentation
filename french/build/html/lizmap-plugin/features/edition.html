

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>L’édition de données dans Lizmap &mdash; Lizmap 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Lizmap 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Fonctionnalités avancées de Lizmap" href="index.html" />
    <link rel="next" title="Ajouter une carte miniature" href="overview-map.html" />
    <link rel="prev" title="Configurer les popups dans Lizmap" href="popups.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="overview-map.html" title="Ajouter une carte miniature"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="popups.html" title="Configurer les popups dans Lizmap"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Lizmap 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Le plugin Lizmap pour QGIS</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Fonctionnalités avancées de Lizmap</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">L&#8217;édition de données dans Lizmap</a><ul>
<li><a class="reference internal" href="#principe">Principe</a></li>
<li><a class="reference internal" href="#deroulement-dans-lizmap-web-client">Déroulement dans Lizmap Web Client</a></li>
<li><a class="reference internal" href="#exemples-d-utilisation">Exemples d&#8217;utilisation</a></li>
<li><a class="reference internal" href="#configurer-l-outil-d-edition">Configurer l&#8217;outil d&#8217;édition</a></li>
<li><a class="reference internal" href="#reutiliser-les-donnees-des-couches-d-edition">Réutiliser les données des couches d&#8217;édition</a></li>
<li><a class="reference internal" href="#utilisation-du-cache">Utilisation du cache</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="popups.html"
                        title="previous chapter">Configurer les popups dans Lizmap</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="overview-map.html"
                        title="next chapter">Ajouter une carte miniature</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/lizmap-plugin/features/edition.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="l-edition-de-donnees-dans-lizmap">
<span id="edition-in-lizmap"></span><h1>L&#8217;édition de données dans Lizmap<a class="headerlink" href="#l-edition-de-donnees-dans-lizmap" title="Permalink to this headline">¶</a></h1>
<div class="section" id="principe">
<h2>Principe<a class="headerlink" href="#principe" title="Permalink to this headline">¶</a></h2>
<p>Depuis la version 2.8, il est possible de permettre aux utilisateurs d&#8217;<strong>éditer des données spatiales et attributaires</strong> depuis l&#8217;interface Lizmap Web Client, pour les couches <strong>Spatialite ou PostGreSQL</strong> du projet QGIS. Le plugin Lizmap permet d&#8217;ajouter une ou plusieurs couches et de choisir pour chacune quelles actions seront possible dans l&#8217;interface web:</p>
<ul class="simple">
<li>création d&#8217;élements</li>
<li>modification des attributs</li>
<li>modification de la géométrie</li>
<li>suppresion d&#8217;éléments</li>
</ul>
<p>Le <strong>formulaire web</strong> présenté à l&#8217;utilisateur pour renseigner la <strong>table attributaire</strong> prend en charge les <strong>Outils d&#8217;éditions</strong> proposés dans l&#8217;onglet <em>Champs</em> des <em>propriétés de la couche</em> vectorielle QGIS. On peut donc configurer une liste déroulante, masquer une colonne, la rendre non-éditable, utiliser une case à cocher, un champ texte, etc. Toute la configuration se fait à la souris, dans QGIS et dans le plugin Lizmap.</p>
<p>De plus, Lizmap Web Client détecte automatiquement le type de colonne (entier, réel, chaîne de caractère, etc.) et ajoute les vérifications et les contrôles nécessaires sur les champs.</p>
</div>
<div class="section" id="deroulement-dans-lizmap-web-client">
<h2>Déroulement dans Lizmap Web Client<a class="headerlink" href="#deroulement-dans-lizmap-web-client" title="Permalink to this headline">¶</a></h2>
<p>Voici par exemple le déroulement d&#8217;un ajout d&#8217;élément à une couche d&#8217;édition dans l&#8217;interface Web</p>
<ul class="simple">
<li>L&#8217;utilisateur sélectionne la couches dans laquelle ajouter un élément via le menu <strong>Edition</strong>.</li>
<li>En fonction des <em>actions configurées</em> pour la couche choisie, des <strong>boutons d&#8217;action</strong> sont affichés dans le panneau d&#8217;édition qui s&#8217;ouvre au dessus de la légende.</li>
<li>Pour ajouter un nouvel élément à la couche d&#8217;édition, l&#8217;utlisateur clique sur le bouton <em>Ajouter</em></li>
<li>Il dessine sur la carte pour numériser l&#8217;élement à ajouter.</li>
<li>Il double-clique le dernier point pour <strong>finaliser la numérisation</strong> de la géométrie.</li>
<li>Un <strong>formulaire</strong> est automatiquement affiché: l&#8217;utilisateur peut remplir les données attributaires via les champs texte, les listes déroulantes, etc.. Le formulaire a été configuré dans QGIS.</li>
<li>Il valide le formulaire.</li>
<li>Lizmap Web Client <strong>contrôle la validité des données</strong> entrées dans les champs du formulaire. Si aucun problème n&#8217;est survenu, la géométrie et les données liées sont automatiquement ajoutée dans la table correspondant à la couche dans la base de données. Sinon le formulaire est affiché et les erreurs à corriger mises en valeur.</li>
<li>La carte se raffraîchit pour montrer les nouvelles données.</li>
</ul>
<p>Pour les couches d&#8217;édition dont la modification de géométrie ou d&#8217;attributs a été configurée, un bouton <strong>Sélectionner</strong> est présenté à l&#8217;utilisateur lorsqu&#8217;il sélectionne la couche via le menu Edition.</p>
<ul class="simple">
<li>Une fois ce bouton cliqué, l&#8217;utilisateur doit cliquer sur la carte pour sélectionner un élément de la couche.</li>
<li>Un panneau s&#8217;ouvre et liste les éléments positionnés sous le clic de l&#8217;utilisateur.</li>
<li>L&#8217;utilisateur sélectionne l&#8217;un des éléments de la liste via le bouton <strong>Sélectionner</strong></li>
<li>Il peut ensuite modifier la géométrie si cette possibilité a été configurée dans le plugin Lizmap.</li>
<li>Ensuite il clique sur le bouton <strong>Valider</strong> , ce qui ouvre le formulaire d&#8217;édition des attributs.</li>
<li>Une fois le formulaire validé, les modifications sont enregistrées dans la couche.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On peut configurer jusqu&#8217;à 5 couches d&#8217;édition.</p>
</div>
</div>
<div class="section" id="exemples-d-utilisation">
<h2>Exemples d&#8217;utilisation<a class="headerlink" href="#exemples-d-utilisation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Une commune</strong> souhaite permettre aux citoyens de recenser les problèmes visibles sur la voirie: poubelles non ramassées, lampadaires en panne, épaves à enlever. L&#8217;administrateur du projet QGIS crée une couche dédiée à ce recueil de données et affiche à tous la donnée.</li>
<li><strong>Un bureau d&#8217;étude</strong> souhaite permettre aux partenaires d&#8217;un projet de remonter des remarques sur des zones du projet. Il permet l&#8217;ajout de polygones dans une couche dédiée.</li>
</ul>
</div>
<div class="section" id="configurer-l-outil-d-edition">
<h2>Configurer l&#8217;outil d&#8217;édition<a class="headerlink" href="#configurer-l-outil-d-edition" title="Permalink to this headline">¶</a></h2>
<p>Pour permettre l&#8217;édition de données dans <em>Lizmap Web Client</em>, il faut</p>
<ul class="simple">
<li><strong>Au moins une couche vectorielle de type PostGis ou Spatialite</strong> dans le projet QGIS</li>
<li><strong>Configurer les outils d&#8217;éditions pour cette couche</strong> dans l&#8217;onglet <em>Champs</em> des propriétés de la couche. Ce n&#8217;est pas obligatoire mais recommandé pour contrôler les données saisies par les utilisateurs.</li>
<li><strong>Ajouter la couche dans l&#8217;outil via le plugin</strong></li>
</ul>
<p>Voici le détail des étapes:</p>
<ol class="arabic simple">
<li>Si nécessaire, <strong>créer une couche</strong> dans votre base de données, du type de géométrie souhaité (point, ligne, polygone, etc.)</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>pensez à ajouter une <strong>clé primaire</strong> : c&#8217;est indispensable !</li>
<li>cette colonne de clé primaire doit être de type <strong>&#8220;auto-incrémenté&#8221;</strong>. Par exemple <em>serial</em> pour PostGresql.</li>
<li>pensez à ajouter un <strong>index spatial</strong> : c&#8217;est important pour les performances</li>
<li><em>créer autant de champs dont vous avez besoin pour les attributs</em> : utiliser si possible des noms de champ simples !</li>
</ul>
<p>Veuillez vous référer à la documentation de QGIS pour voir comment créer une couche spatiale dans une base de données PostGIS ou Spatialite: <a class="reference external" href="http://docs.qgis.org/html/fr/docs/user_manual/index.html">http://docs.qgis.org/html/fr/docs/user_manual/index.html</a></p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><strong>Configurer les outils d&#8217;édition</strong> pour les champs de votre couche</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><em>Ouvrir les propriétés de la couche</em> en double-cliquant sur le nom de la couche dans la légende</li>
<li>Aller à l&#8217;onglet <em>Champs</em></li>
<li>Choisir l&#8217;<em>Outil d&#8217;édition</em> via la liste déroulante pour chacun des champs de la couche<ul>
<li>Pour masquer un champ, choisir <em>Cachée</em>. L&#8217;utilisateur ne verra pas ce champ dans le formulaire. Aucun contenu n&#8217;y sera écrit. <em>Utilisez-le pour la clé primaire</em></li>
<li>Pour afficher un champ en lecture seule, choisir <em>Immuable</em></li>
<li>Cas particulier de l&#8217;option <em>Valeur relationnelle</em>. Vous pouvez utiliser cette option pour une carte Lizmap. Pour que les utilisateurs aient accès aux informations de la couche externe qui contient les données, il faut activer la publication de la couche en WFS dans l&#8217;onglet <em>Serveur OWS</em> de la boîte de dialogue <em>Propriétés du projet</em> dans QGIS.</li>
<li>etc.</li>
</ul>
</li>
<li><strong>Evolutions de QGIS 2</strong> :<ul>
<li>Pour masquer des colonnes dans la popup de Lizmap, il faut maintenant décocher la case dans la colonne <em>WMS</em> pour chaque champs à cacher (cette colonne est juste après <em>Alias</em> )</li>
<li>Lizmap Web Client ne sait pas encore utiliser le mode <em>Conception par glisser/déposer</em> pour la génération des formulaires. Il faut donc seulement utiliser le mode <em>Autogénérer</em> pour les couches d&#8217;édition.</li>
</ul>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Tous les outils d&#8217;édition ne sont pas encore gérés par Lizmap Web Client. Seuls les outils suivants le sont: Edition de ligne, Classification, Plage, Liste de valeurs, Immuable, Cachée, Boite à cocher, Edition de texte, Calendrier, Valeur relationnelle. Si l&#8217;outil n&#8217;est pas gérée, le formulaire web affichera un champ texte libre.</p>
</div>
<ol class="arabic simple" start="4">
<li>Ajouter la couche dans le tableau <strong>Édition de couches</strong> situé dans l&#8217;onglet <em>Outils</em> du plugin Lizmap:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><em>Sélectionner la couche</em> dans la liste déroulante</li>
<li>Cocher les actions que vous souhaitez activer parmi: <em>Créer, Modifier les attributs, Modifier la géométrie, Supprimer</em></li>
<li>Ajouter la couche dans la liste via le bouton <em>Ajouter la couche</em></li>
</ul>
</div></blockquote>
<img alt="../../_images/features-edition-table.png" class="align-center" src="../../_images/features-edition-table.png" style="width: 80%;" />
</div>
<div class="section" id="reutiliser-les-donnees-des-couches-d-edition">
<h2>Réutiliser les données des couches d&#8217;édition<a class="headerlink" href="#reutiliser-les-donnees-des-couches-d-edition" title="Permalink to this headline">¶</a></h2>
<p>Les couches que vous avez sélectionnées pour l&#8217;outil d&#8217;édition sont des <strong>couches comme les autres</strong>, ce qui implique:</p>
<ul class="simple">
<li><strong>Les styles et les étiquettes de QGIS s&#8217;appliquent sur ces couches.</strong> On peut donc créer des styles qui et des étiquettes qui dépendent d&#8217;une valeur d&#8217;une des colonnes de la couche.</li>
<li>Si on souhaite proposer l&#8217;outil d&#8217;édition, mais ne pas permettre aux utilisateurs de voir les données de la couche en ligne ( et donc les ajouts des autres utilisateurs) : <strong>on peut simplement masquer la ou les couches d&#8217;édition</strong> en les mettant dans un répertoire <em>hidden</em>. Voir <a class="reference internal" href="hide-layers.html#hide-layers"><em>Masquer des couches du projet dans l&#8217;application Web</em></a></li>
<li><strong>Les couches sont imprimables</strong> si elles ne sont pas masquées.</li>
<li><strong>Les données sont enregistrées dans une couche du projet</strong>. L&#8217;administrateur peut donc récupérer ces données et les utiliser par la suite.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour bien centraliser les choses, nous conseillons d&#8217;utiliser une base de données PostGis pour stocker les données. Pour les couches Spatialite, il faut faire attention à ne pas écraser le fichier Spatialite stocké dans le répertoire Lizmap sur le serveur par celui que vous avez en local: pensez à toujours faire une sauvegarde du fichier du serveur avant une nouvelle synchronisation de votre répertoire local.</p>
</div>
</div>
<div class="section" id="utilisation-du-cache">
<h2>Utilisation du cache<a class="headerlink" href="#utilisation-du-cache" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Si vous souhaitez utiliser le cache serveur ou client pour les couches d&#8217;édition, faites-le en toute connaissance de cause : les données ne seront pas visibles par les utilisateurs tant que le cache ne sera pas expiré. Nous conseillons de ne pas activer le cache pour les couches d&#8217;édition</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="overview-map.html" title="Ajouter une carte miniature"
             >next</a> |</li>
        <li class="right" >
          <a href="popups.html" title="Configurer les popups dans Lizmap"
             >previous</a> |</li>
        <li><a href="../../index.html">Lizmap 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Le plugin Lizmap pour QGIS</a> &raquo;</li>
          <li><a href="index.html" >Fonctionnalités avancées de Lizmap</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, 3liz.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>